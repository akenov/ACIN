import itertools
import numpy as np
import matplotlib.pyplot as plt

import importlib
from matplotlib2tikz import save as tikz_save

# DHG Classes
class_names = [
    "Grab",
    "Tap",
    "Expand",
    "Pinch",
    "Rotation CW",
    "Rotation CCW",
    "Swipe Right",
    "Swipe Left",
    "Swipe Up",
    "Swipe Down",
    "Swipe X",
    "Swipe V",
    "Swipe +",
    "Shake"
]
# DHG CNN +No Augmentations AVERAGE CONFUSION MATRIX Runs = 3
# title = "DHG CNN No Augmentations"
# png_file = "dhg.cnn.noaug.png"
# cnf_matrix = np.array(
#     [[29.00, 12.67, 11.67, 21.00, 04.67, 00.67, 02.67, 00.67, 03.00, 06.33, 00.33, 00.00, 02.33, 05.00],
#      [11.33, 40.67, 04.33, 08.67, 09.33, 00.00, 05.00, 03.00, 02.00, 06.33, 00.67, 02.00, 00.33, 06.33],
#      [16.67, 08.67, 24.33, 06.67, 03.33, 02.33, 04.33, 04.00, 13.67, 01.33, 02.00, 01.67, 04.33, 06.67],
#      [27.67, 10.00, 06.33, 24.67, 02.67, 03.33, 02.33, 02.33, 03.67, 08.00, 01.67, 01.67, 00.33, 05.33],
#      [06.33, 10.33, 04.00, 05.33, 43.33, 01.67, 07.33, 04.67, 02.67, 02.67, 02.33, 00.33, 02.00, 07.00],
#      [07.00, 01.00, 02.00, 09.00, 02.00, 55.67, 00.67, 11.00, 02.33, 03.67, 02.67, 02.00, 00.33, 00.67],
#      [04.00, 05.67, 04.00, 01.00, 04.33, 00.67, 53.33, 00.33, 00.33, 00.67, 06.33, 05.33, 11.00, 03.00],
#      [02.00, 03.67, 02.33, 02.00, 04.67, 06.67, 01.00, 58.67, 01.67, 04.67, 04.67, 02.67, 00.00, 05.33],
#      [07.33, 03.67, 13.67, 03.67, 02.33, 01.67, 02.33, 02.67, 41.67, 00.67, 01.33, 04.00, 04.00, 11.00],
#      [08.00, 05.33, 02.00, 08.33, 01.67, 01.00, 00.33, 06.00, 00.33, 51.33, 03.33, 04.00, 02.33, 06.00],
#      [02.00, 00.33, 02.33, 01.67, 02.67, 01.33, 05.33, 03.33, 01.00, 01.67, 55.00, 06.33, 13.33, 03.67],
#      [03.00, 01.67, 01.33, 01.00, 00.67, 02.67, 01.33, 04.00, 01.00, 07.33, 06.33, 62.67, 04.67, 02.33],
#      [02.00, 00.00, 02.00, 01.00, 01.00, 00.00, 13.33, 00.33, 03.67, 00.00, 03.33, 05.67, 64.67, 03.00],
#      [04.00, 09.00, 03.67, 07.00, 06.33, 01.33, 02.00, 04.67, 06.67, 08.67, 04.67, 03.67, 03.33, 35.00]]
# )

# # DHG CNN +SCALE Augmentations AVERAGE CONFUSION MATRIX Runs = 3
# title = "DHG CNN +Scale Augmentations"
# png_file = "dhg.cnn.scaleaug.png"
# cnf_matrix = np.array(
#     [[25.67, 12.67, 02.33, 04.33, 12.00, 02.67, 15.33, 02.00, 09.00, 06.33, 07.00, 00.67, 00.00, 00.00],
#      [15.33, 36.67, 01.67, 03.67, 09.33, 00.33, 20.00, 01.67, 03.67, 02.33, 04.33, 00.33, 00.00, 00.67],
#      [14.67, 12.67, 06.67, 05.33, 03.33, 02.00, 30.33, 00.67, 06.00, 00.33, 14.33, 02.67, 01.00, 00.00],
#      [29.00, 10.00, 03.33, 10.00, 11.00, 01.33, 23.67, 01.00, 02.67, 01.67, 04.33, 01.00, 00.67, 00.33],
#      [08.33, 03.33, 03.33, 02.67, 35.67, 00.00, 29.33, 02.00, 00.33, 01.67, 09.33, 03.00, 00.67, 00.33],
#      [12.67, 04.00, 02.33, 09.67, 07.33, 29.00, 09.00, 08.00, 01.67, 04.33, 09.67, 00.67, 01.00, 00.67],
#      [02.00, 05.67, 00.33, 00.00, 10.33, 00.67, 63.00, 01.00, 00.67, 00.00, 11.00, 01.00, 04.33, 00.00],
#      [08.00, 13.00, 01.33, 02.33, 08.33, 02.00, 09.67, 39.33, 00.67, 04.33, 05.67, 02.00, 00.00, 03.33],
#      [12.67, 05.00, 03.33, 00.67, 07.00, 00.00, 32.33, 00.33, 19.67, 01.67, 08.33, 04.67, 02.67, 01.67],
#      [09.00, 13.00, 00.33, 03.33, 10.00, 01.00, 17.67, 04.67, 09.00, 19.00, 04.67, 03.00, 03.33, 02.00],
#      [00.67, 01.00, 01.33, 00.33, 03.33, 00.00, 16.00, 02.00, 03.67, 00.67, 53.67, 02.33, 13.67, 01.33],
#      [03.00, 01.00, 00.33, 00.67, 02.00, 00.67, 08.00, 03.00, 04.00, 05.67, 24.00, 42.00, 04.67, 01.00],
#      [03.33, 00.33, 01.00, 00.00, 01.67, 00.00, 34.33, 01.00, 01.33, 00.67, 13.67, 06.33, 36.33, 00.00],
#      [03.33, 09.00, 00.00, 04.67, 13.00, 00.33, 26.67, 03.67, 09.33, 07.00, 09.00, 04.00, 01.67, 08.33]]
# )

# DHG CNN +SHIFT Augmentations AVERAGE CONFUSION MATRIX Runs = 3
title = "DHG CNN +Shift Augmentations"
png_file = "dhg.cnn.shiftaug.png"
cnf_matrix = np.array(
    [[28.00, 15.67, 04.33, 05.67, 08.67, 01.67, 11.33, 03.33, 07.33, 06.67, 06.33, 00.67, 00.33, 00.00],
     [12.67, 37.67, 00.67, 09.00, 12.67, 00.00, 15.33, 03.33, 04.00, 02.67, 01.33, 00.33, 00.00, 00.33],
     [15.00, 09.67, 08.67, 07.67, 06.00, 01.33, 26.00, 00.33, 06.33, 00.00, 12.67, 04.00, 02.33, 00.00],
     [29.67, 08.33, 05.33, 12.00, 10.67, 01.67, 17.33, 01.67, 02.00, 01.00, 05.67, 01.33, 02.67, 00.67],
     [07.67, 04.00, 02.33, 04.00, 38.00, 00.33, 24.67, 01.00, 01.33, 00.67, 10.67, 02.00, 02.33, 01.00],
     [09.00, 04.67, 03.00, 11.67, 07.33, 31.33, 09.67, 08.33, 01.00, 03.67, 09.33, 00.33, 00.00, 00.67],
     [01.33, 08.33, 00.33, 00.00, 09.33, 00.33, 63.33, 01.00, 01.00, 00.00, 08.00, 01.00, 06.00, 00.00],
     [05.33, 15.00, 02.67, 04.00, 10.00, 04.00, 11.00, 35.00, 01.00, 01.67, 05.33, 01.33, 00.00, 03.67],
     [09.33, 04.67, 03.67, 05.33, 05.67, 00.00, 26.00, 00.33, 24.67, 01.67, 09.33, 03.00, 04.67, 01.67],
     [10.00, 11.67, 01.33, 04.33, 13.33, 00.00, 15.33, 04.00, 07.33, 19.67, 04.00, 03.00, 02.67, 03.33],
     [00.33, 01.00, 02.00, 00.33, 02.00, 00.00, 18.00, 01.67, 04.00, 00.33, 53.67, 04.67, 09.67, 02.33],
     [00.67, 01.33, 00.67, 00.33, 05.67, 00.33, 06.00, 04.33, 05.33, 04.33, 20.33, 45.00, 04.00, 01.67],
     [04.00, 00.33, 00.33, 00.33, 03.67, 00.00, 30.33, 01.00, 01.67, 01.33, 11.33, 03.00, 40.00, 02.67],
     [04.67, 10.00, 03.00, 04.33, 10.67, 00.00, 22.33, 03.33, 09.33, 06.33, 08.67, 04.33, 02.00, 11.00]]
)

# Plot normalized confusion matrix
plt.figure()
cmap = plt.cm.Blues
plt.imshow(cnf_matrix, interpolation='nearest', cmap=cmap, aspect='auto')
plt.title(title)
# plt.colorbar()
tick_marks = np.arange(len(class_names))
plt.xticks(tick_marks, class_names, rotation=45)
plt.yticks(tick_marks, class_names)
cm = cnf_matrix
fmt = '.2f'  # if normalize else 'd'
thresh = cm.max() / 2.
for i, j in itertools.product(range(cm.shape[0]), range(cm.shape[1])):
    plt.text(j, i, format(cm[i, j], fmt), fontsize=6,
             horizontalalignment="center", ha="center", va="center",
             color="white" if cm[i, j] > thresh else "black")

# plt.tight_layout()
# plt.ylabel('True label')
# plt.xlabel('Predicted label')

# plt.show()
plt.savefig(png_file, bbox_inches='tight', dpi=600)
# tikz_save("test.tex", figureheight='4cm', figurewidth='6cm')
# plt.clf()


